# tile-downscaler

XYZ形式の地図タイルを高ズームレベルから低ズームレベルへダウンスケールするためのPythonスクリプトです。高解像度のタイルセットから低ズームレベルのタイルを自動生成し、完全なマルチスケールタイルセットを作成します。

## 機能

- 高ズームレベルのタイルから低ズームレベルのタイルを自動生成
- 透明度（アルファチャンネル）のサポート
- 欠けているタイルを透明色で自動補完
- マルチプロセス並列処理によるパフォーマンス向上
- 詳細なログ出力オプション

## 必要条件

- Python 3.6以上
- Pillow (PIL Fork) ライブラリ

## インストール

```bash
# リポジトリのクローン
git clone https://github.com/yourusername/tile-downscaler.git
cd tile-downscaler

# 依存関係のインストール
pip install Pillow
```

## 使用方法

```bash
# 基本的な使用方法（ズームレベル18から10を生成）
python downscale_tiles.py /path/to/tiles

# カスタムズームレベルの指定
python downscale_tiles.py /path/to/tiles --source-zoom 16 --dest-zoom-min 8

# 並列処理を使用
python downscale_tiles.py /path/to/tiles --workers 4

# 詳細なログ出力
python downscale_tiles.py /path/to/tiles --verbose
```

### コマンドラインオプション

| オプション | 短縮形 | 説明 |
|------------|--------|------|
| `--source-zoom` | `-s` | ソースタイルのズームレベル (デフォルト: 18) |
| `--dest-zoom-min` | `-d` | 生成する最小ズームレベル (デフォルト: 10) |
| `--workers` | `-w` | 並列処理に使用するワーカー数 (デフォルト: 1) |
| `--verbose` | `-v` | 詳細なログ出力を有効にする |

## タイルディレクトリ構造

このスクリプトは以下のようなXYZ形式のタイルディレクトリ構造を前提としています：

```
/path/to/tiles/
  ├── 18/  # ズームレベル18（ソース）
  │   ├── x/
  │   │   ├── y.png
  │   │   └── ...
  │   └── ...
  ├── 17/  # ズームレベル17（生成される）
  ├── 16/  # ズームレベル16（生成される）
  └── ...
```

## 処理の流れ

1. 指定されたソースズームレベルのタイルを読み込む
2. 各ズームレベルに対して、高ズームレベルの4つのタイル（2x2）から1つの低ズームレベルタイルを生成
3. 欠けているタイルがある場合は透明色で補完
4. 生成したタイルを保存
5. 次のズームレベルの処理に進む

## 注意事項

- メモリ使用量はタイルの数とサイズによって増加します
- 大量のタイルを処理する場合は、`--workers` オプションで並列処理を調整してください
- PNGフォーマットでアルファチャンネル（透明度）が保持されます

## ライセンス

MIT

## 貢献

バグレポートや機能リクエストは GitHub Issues にお願いします。
プルリクエストも歓迎です。